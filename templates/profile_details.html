{% extends "base.html" %}

{% block content %}
<div class="container mt-5 d-flex justify-content-center align-items-center" style="min-height: 80vh;">
    <div class="card shadow-lg text-center" style="max-width: 420px; width: 100%; border-radius: 25px; overflow: hidden; background: linear-gradient(to bottom, #1f1f1f, #2a2a2a);">
        <!-- Header Gradient -->
        <div class="card-header p-4" style="background: linear-gradient(135deg, #ff512f, #dd2476);">
            <h2 class="text-white fw-bold mb-0" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.5);">
                {{ profile.name }}
            </h2>
            <small class="text-white-50">Profile Details</small>
        </div>

        <div class="card-body">
            <!-- Devices Count -->
            <p class="fs-4 my-3">
                <span class="badge bg-warning text-dark px-4 py-2 shadow-sm">
                    {{ devices }}
                </span>
                Devices Connected
            </p>

            <!-- Internet Access Toggle -->
            <div class="form-check form-switch mt-4 d-flex justify-content-center align-items-center gap-3">
                <input class="form-check-input internet-toggle" type="checkbox" 
                       id="profileInternetToggle" 
                       data-profile-name="{{ profile.name }}"
                       {% if profile.internet_access %}checked{% endif %}>
                <label class="form-check-label fs-5 fw-semibold text-white" for="profileInternetToggle">
                    Internet Access
                </label>
            </div>

            <!-- Back Button -->
            <div class="mt-4">
                <a href="{{ url_for('family_profiles') }}" class="btn btn-gradient btn-lg text-white shadow-sm">
                    <i class="fas fa-arrow-left"></i> Back to Profiles
                </a>
            </div>
        </div>
    </div>
</div>

<!-- CSRF Token -->
<meta name="csrf-token" content="{{ form.csrf_token._value() }}">

<!-- Internet Toggle Script -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

    document.querySelectorAll('.internet-toggle').forEach(toggle => {
        toggle.addEventListener('change', async function() {
            const profileName = this.dataset.profileName;
            const enable = this.checked;

            try {
                const response = await fetch("/toggle_internet", {
                    method: "POST",
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({profile_name: profileName, enable: enable})
                });

                const result = await response.json();

                if (result.success) {
                    alert(`Internet ${enable ? 'enabled' : 'disabled'} for ${profileName}`);
                } else {
                    alert(`Failed: ${result.message}`);
                    this.checked = !enable;
                }
            } catch (err) {
                alert('Error toggling internet: ' + err);
                this.checked = !enable;
            }
        });
    });
});
</script>

<!-- Styles -->
<style>
.card { transition: transform 0.3s, box-shadow 0.3s; color: #fff; }
.card:hover { transform: translateY(-10px); box-shadow: 0 25px 40px rgba(0,0,0,0.5); }

.badge { font-size: 1.5rem; font-weight: bold; transition: transform 0.2s; }
.badge:hover { transform: scale(1.1); }

.btn-gradient {
    background: linear-gradient(135deg, #00c6ff, #0072ff);
    border: none; border-radius: 50px; padding: 12px 30px;
    font-weight: bold; font-size: 1rem;
    transition: transform 0.2s, box-shadow 0.2s;
}
.btn-gradient:hover { transform: scale(1.05); box-shadow: 0 12px 25px rgba(0,0,0,0.4); text-decoration: none; }

.form-check-label { text-shadow: 0px 1px 2px rgba(0,0,0,0.5); }
</style>
{% endblock %}
